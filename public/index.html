<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>文件资源管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/file-management.css">
    <link rel="stylesheet" href="css/drag-drop.css">
    <link rel="stylesheet" href="css/screenshot.css">
    <link rel="stylesheet" href="css/screenshot-animation.css">
    <link rel="stylesheet" href="css/duplicate-file-popup.css">
    <link rel="stylesheet" href="css/image-collection.css">
</head>
<body>
    <!-- 导航区 -->
    <nav class="sidebar">
        <div class="logo">
            <i class="ti ti-files logo-icon"></i>
            <span class="logo-text">FileManager</span>
        </div>
        <ul class="nav-list" id="navList">
            <li class="nav-item">
                <a href="#" class="nav-link active touch-feedback" data-page="dashboard">
                    <i class="ti ti-home nav-icon"></i>
                    <span>仪表盘</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link touch-feedback" data-page="items">
                    <i class="ti ti-package nav-icon"></i>
                    <span>道具</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link touch-feedback" data-page="skills">
                    <i class="ti ti-flame nav-icon"></i>
                    <span>技能</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link touch-feedback" data-page="characters">
                    <i class="ti ti-user nav-icon"></i>
                    <span>人物</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link touch-feedback" data-page="talents">
                    <i class="ti ti-stars nav-icon"></i>
                    <span>天赋</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link touch-feedback" data-page="others">
                    <i class="ti ti-box-multiple nav-icon"></i>
                    <span>其他</span>
                </a>
            </li>
            <!-- 新增万相集导航项 -->
            <li class="nav-item">
                <a href="#" class="nav-link touch-feedback" data-page="images">
                    <i class="ti ti-photo nav-icon"></i>
                    <span>万相集</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link touch-feedback" data-page="more">
                    <i class="ti ti-dots nav-icon"></i>
                    <span>更多</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- 主内容区 -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title" id="pageTitle">仪表盘</h1>
            <p class="page-description" id="pageDescription">管理您的资源文件，导入并查看内容</p>
        </div>

        <!-- 公告模块（仅在仪表盘显示） -->
        <section class="announcement-section" id="announcementSection">
            <div class="announcement-header">
                <h2 class="section-title">
                    <i class="ti ti-speakerphone"></i>
                    系统公告
                </h2>
                <div class="announcement-controls">
                    <button class="announcement-btn prev-btn touch-feedback" id="prevAnnouncement">
                        <i class="ti ti-chevron-left"></i>
                    </button>
                    <span class="announcement-counter" id="announcementCounter">1/1</span>
                    <button class="announcement-btn next-btn touch-feedback" id="nextAnnouncement">
                        <i class="ti ti-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="announcement-container" id="announcementContainer">
                <div class="announcement-track" id="announcementTrack">
                    <!-- 公告内容将由JavaScript动态生成 -->
                </div>
            </div>
        </section>

        <!-- 导入模块（仅在仪表盘显示） -->
        <section class="import-section" id="importSection">
            <h2 class="section-title">
                <i class="ti ti-file-import"></i>
                导入订阅模块
            </h2>
            
            <!-- 图片导入提示 -->
            <div class="image-import-notice" id="imageImportNotice" style="display: none;">
                <i class="ti ti-photo"></i>
                <span>检测到图片文件，将自动导入到万相集</span>
            </div>
            
            <div class="category-selector">
                <div class="category-label">选择导入位置：</div>
                <div class="category-options">
                    <div class="category-option touch-feedback active" data-category="items">道具</div>
                    <div class="category-option touch-feedback" data-category="skills">技能</div>
                    <div class="category-option touch-feedback" data-category="characters">人物</div>
                    <div class="category-option touch-feedback" data-category="talents">天赋</div>
                    <div class="category-option touch-feedback" data-category="others">其他</div>
                </div>
            </div>
            
            <div class="file-input-container">
                <input type="file" id="fileInput" class="file-input" accept=".json,.txt,.xml,.csv,.js,.java,.py,.c,.cpp,.h,.html,.css,.php,.sql,.jpg,.jpeg,.png,.gif,.bmp,.webp,.svg,.tiff,.ico" multiple>
                <button class="btn btn-primary touch-feedback" id="importBtn">
                    <i class="ti ti-upload"></i>
                    导入文件
                </button>
            </div>
            <p>支持 JSON、TXT、XML、CSV、代码文件，以及 JPG、PNG、GIF、BMP、WebP、SVG 等格式的图片文件，可多选</p>
            
            <div class="save-config">
                <button class="btn btn-secondary touch-feedback" id="saveConfigBtn">
                    <i class="ti ti-device-floppy"></i>
                    保存配置到本地
                </button>
            </div>
        </section>

        <!-- 宫格卡片区域 -->
        <section class="grid-section" id="gridSection">
            <h2 class="section-title">
                <i class="ti ti-layout-grid"></i>
                <span id="sectionTitle">资源文件</span>
            </h2>
            
            <div class="grid-container" id="fileGrid">
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="ti ti-folder-off"></i>
                    <h3>暂无文件</h3>
                    <p>导入文件后，将在此显示</p>
                </div>
            </div>
        </section>

        <!-- 更多页面内容 -->
        <section class="import-section" id="moreSection" style="display: none;">
            <div class="settings-vertical">
                <div class="settings-card">
                    <h2 class="section-title">
                        <i class="ti ti-palette"></i>
                        主题设置
                    </h2>
                    
                    <div class="theme-selector">
                        <div class="category-label">选择主题：</div>
                        <div class="theme-options">
                            <div class="theme-option touch-feedback active" data-theme="light">浅色</div>
                            <div class="theme-option touch-feedback" data-theme="dark">深色</div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-card">
                    <h2 class="section-title">
                        <i class="ti ti-database"></i>
                        数据管理
                    </h2>
                    
                    <!-- 文件管理按钮 -->
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary touch-feedback" id="fileManagementBtn">
                            <i class="ti ti-files"></i>
                            文件管理
                        </button>
                        <button class="btn btn-success touch-feedback" id="imageManagementBtn" style="margin-left: 10px;">
                            <i class="ti ti-photo"></i>
                            图片管理
                        </button>
                    </div>
                    
                    <!-- 存储使用情况 -->
                    <div class="storage-info">
                        <div class="storage-header">
                            <span class="storage-label">存储使用情况</span>
                            <span class="storage-percentage" id="storagePercentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="storage-details">
                            <span id="storageUsed">0 KB</span>
                            <span id="storageTotal">0 KB</span>
                        </div>
                    </div>
                    
                    <div class="data-import-section">
                        <h3 class="section-title" style="font-size: 16px;">
                            <i class="ti ti-file-import"></i>
                            导入数据文件
                        </h3>
                        
                        <div class="file-input-container">
                            <input type="file" id="dataFileInput" class="file-input" accept=".json">
                            <button class="btn btn-success touch-feedback" id="importDataBtn">
                                <i class="ti ti-upload"></i>
                                导入数据
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-secondary touch-feedback" id="exportDataBtn">
                            <i class="ti ti-download"></i>
                            导出所有数据
                        </button>
                        <button class="btn btn-primary touch-feedback" id="exportImagesBtn" style="margin-left: 10px;">
                            <i class="ti ti-download"></i>
                            导出图片数据
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-danger touch-feedback" id="clearAllDataBtn">
                            <i class="ti ti-trash"></i>
                            清空所有资源文件
                        </button>
                        <button class="btn btn-warning touch-feedback" id="clearImagesBtn" style="margin-left: 10px;">
                            <i class="ti ti-trash"></i>
                            清空所有图片
                        </button>
                    </div>
                </div>
                
                <!-- 控制台设置 -->
                <div class="settings-card">
                    <h2 class="section-title">
                        <i class="ti ti-terminal-2"></i>
                        系统控制台
                    </h2>
                    
                    <div class="console-section">
                        <div class="console-input-group">
                            <input type="text" class="console-input" id="consoleInput" placeholder="输入命令...">
                            <button class="btn btn-primary touch-feedback" id="executeCommand">
                                <i class="ti ti-player-play"></i>
                                执行
                            </button>
                            <button class="btn btn-secondary touch-feedback" id="resetConsole">
                                <i class="ti ti-refresh"></i>
                                重置
                            </button>
                        </div>
                        
                        <div class="console-output" id="consoleOutput">
// 文件资源管理系统控制台 v2.1
// 输入 "help" 查看可用命令
                        </div>
                        
                        <div class="console-commands">
                            <h4>可用命令：</h4>
                            <ul>
                                <li><code>help</code> - 显示帮助信息</li>
                                <li><code>clear</code> - 清空控制台输出</li>
                                <li><code>theme [light|dark]</code> - 切换主题</li>
                                <li><code>storage</code> - 显示存储信息</li>
                                <li><code>files</code> - 显示文件统计</li>
                                <li><code>images</code> - 显示图片统计</li>
                                <li><code>reset nav</code> - 重置导航栏名称</li>
                                <li><code>reset [导航名] [新名称]</code> - 重命名导航项</li>
                                <li><code>reset all</code> - 重置所有设置为默认</li>
                                <li><code>version</code> - 显示系统版本</li>
                                <li><code>time</code> - 显示当前时间</li>
                                <li><code>announce</code> - 显示公告信息</li>
                                <li><code>export</code> - 导出所有数据</li>
                                <li><code>import</code> - 导入数据文件</li>
                                <li><code>favorite [文件ID]</code> - 切换文件收藏状态</li>
                                <li><code>move [文件ID] [目标分类]</code> - 移动文件到其他分类</li>
                                <li><code>segments [文件ID] [段数]</code> - 设置代码段数</li>
                                <li><code>clear images</code> - 清空所有图片</li>
                                <li><code>export images</code> - 导出图片数据</li>
                            </ul>
                            
                            <h4 style="margin-top: 15px;">快捷键：</h4>
                            <ul>
                                <li><code>Ctrl/Cmd + Z</code> - 撤回上一条命令</li>
                                <li><code>Tab</code> - 命令补全</li>
                                <li><code>↑/↓</code> - 浏览命令历史</li>
                                <li><code>Ctrl/Cmd + K</code> - 聚焦控制台输入框</li>
                                <li><code>Ctrl/Cmd + S</code> - 保存配置</li>
                                <li><code>Ctrl/Cmd + D</code> - 返回仪表盘</li>
                                <li><code>Ctrl/Cmd + I</code> - 导入文件</li>
                                <li><code>Ctrl/Cmd + E</code> - 导出数据</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- 导航栏重命名 -->
                <div class="settings-card">
                    <h2 class="section-title">
                        <i class="ti ti-edit"></i>
                        导航栏重命名
                    </h2>
                    
                    <div class="navigation-rename-section">
                        <div class="rename-controls" id="renameControls">
                            <!-- 动态生成的重命名项 -->
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button class="btn btn-secondary touch-feedback" id="resetNavNames">
                                <i class="ti ti-refresh"></i>
                                重置导航栏名称
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 图片管理设置 -->
                <div class="settings-card">
                    <h2 class="section-title">
                        <i class="ti ti-photo"></i>
                        图片管理设置
                    </h2>
                    
                    <div class="image-settings">
                        <div class="setting-item">
                            <label class="setting-label">图片质量设置：</label>
                            <select class="setting-select" id="imageQuality">
                                <option value="high">高质量（保持原图）</option>
                                <option value="medium" selected>中等质量（推荐）</option>
                                <option value="low">较低质量（节省空间）</option>
                            </select>
                        </div>
                        
                        <div class="setting-item">
                            <label class="setting-label">最大图片尺寸：</label>
                            <select class="setting-select" id="maxImageSize">
                                <option value="original">保持原尺寸</option>
                                <option value="1920" selected>1920px（高清）</option>
                                <option value="1280">1280px（标准）</option>
                                <option value="800">800px（缩略图）</option>
                            </select>
                        </div>
                        
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="autoCompressImages" checked>
                                自动压缩大图片
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="lazyLoadImages" checked>
                                启用图片懒加载
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary touch-feedback" id="applyImageSettings">
                            <i class="ti ti-check"></i>
                            应用设置
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 文件内容弹窗 -->
    <div class="modal-overlay" id="fileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">文件内容</h3>
                <button class="btn btn-secondary touch-feedback" id="closeModal">
                    <i class="ti ti-x"></i>
                    关闭
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 文件内容将在这里显示 -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <!-- 按钮将由JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 图片预览弹窗 -->
    <div class="modal-overlay" id="imagePreviewModal" style="display: none;">
        <div class="modal-content image-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="imageModalTitle">图片预览</h3>
                <button class="btn btn-secondary touch-feedback" id="closeImageModal">
                    <i class="ti ti-x"></i>
                    关闭
                </button>
            </div>
            <div class="modal-body image-modal-body" id="imageModalBody">
                <!-- 图片将在这里显示 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary touch-feedback" id="downloadFromModal">
                    <i class="ti ti-download"></i>
                    下载
                </button>
                <button class="btn btn-success touch-feedback" id="copyImageLink">
                    <i class="ti ti-copy"></i>
                    复制链接
                </button>
            </div>
        </div>
    </div>

    <!-- 公告详情弹窗 -->
    <div class="modal-overlay" id="announcementModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="announcementModalTitle">公告详情</h3>
                <button class="btn btn-secondary touch-feedback" id="closeAnnouncementModal">
                    <i class="ti ti-x"></i>
                    关闭
                </button>
            </div>
            <div class="modal-body announcement-modal-body" id="announcementModalBody">
                <!-- 公告详情内容将由JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 移动文件弹窗 -->
    <div class="modal-overlay" id="moveFileModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">移动文件</h3>
                <button class="btn btn-secondary touch-feedback" id="closeMoveFileModal">
                    <i class="ti ti-x"></i>
                    关闭
                </button>
            </div>
            <div class="modal-body" id="moveFileModalBody">
                <!-- 移动选项将在这里显示 -->
            </div>
        </div>
    </div>

    <!-- 文件管理弹窗 -->
    <div class="modal-overlay" id="fileManagementModal">
        <div class="modal-content file-management-modal">
            <div class="modal-header">
                <h3 class="modal-title">文件管理</h3>
                <button class="btn btn-secondary touch-feedback" id="closeFileManagementModal">
                    <i class="ti ti-x"></i>
                    关闭
                </button>
            </div>
            <div class="modal-body">
                <div class="file-management-tabs">
                    <button class="file-management-tab active touch-feedback" data-tab="all">全部文件</button>
                    <button class="file-management-tab touch-feedback" data-tab="favorites">收藏文件</button>
                    <button class="file-management-tab touch-feedback" data-tab="items">道具</button>
                    <button class="file-management-tab touch-feedback" data-tab="skills">技能</button>
                    <button class="file-management-tab touch-feedback" data-tab="characters">人物</button>
                    <button class="file-management-tab touch-feedback" data-tab="talents">天赋</button>
                    <button class="file-management-tab touch-feedback" data-tab="others">其他</button>
                </div>
            
                <!-- 批量操作区域 -->
                <div class="file-management-batch-actions" id="batchActions">
                    <span id="selectedCount">已选择 0 个文件</span>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-danger touch-feedback" id="batchDelete">
                            <i class="ti ti-trash"></i>
                            批量删除
                        </button>
                        <button class="btn btn-primary touch-feedback" id="batchDownload">
                            <i class="ti ti-download"></i>
                            批量下载
                        </button>
                        <button class="btn btn-secondary touch-feedback" id="batchMove">
                            <i class="ti ti-arrow-right"></i>
                            批量移动
                        </button>
                    </div>
                </div>

                <!-- 单文件操作区域 -->
                <div class="file-management-single-actions" id="singleActions">
                    <span id="singleSelectedCount">已选择 1 个文件</span>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-danger touch-feedback" id="singleDelete">
                            <i class="ti ti-trash"></i>
                            删除
                        </button>
                        <button class="btn btn-primary touch-feedback" id="singleDownload">
                            <i class="ti ti-download"></i>
                            下载
                        </button>
                        <button class="btn btn-secondary touch-feedback" id="singleMove">
                            <i class="ti ti-arrow-right"></i>
                            移动
                        </button>
                        <button class="btn btn-success touch-feedback" id="singleRename">
                            <i class="ti ti-edit"></i>
                            重命名
                        </button>
                    </div>
                </div>
            
                <div class="file-management-content">
                    <div class="file-management-list" id="fileManagementList">
                        <!-- 文件列表将由JavaScript动态生成 -->
                    </div>
                </div>
            
                <div class="file-management-actions">
                    <button class="btn btn-secondary touch-feedback" id="selectAllFiles">
                        <i class="ti ti-square"></i>
                        全选
                    </button>
                    <button class="btn btn-secondary touch-feedback" id="cancelSelection">
                        <i class="ti ti-x"></i>
                        取消选择
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 图片管理弹窗 -->
    <div class="modal-overlay" id="imageManagementModal">
        <div class="modal-content file-management-modal">
            <div class="modal-header">
                <h3 class="modal-title">图片管理</h3>
                <button class="btn btn-secondary touch-feedback" id="closeImageManagementModal">
                    <i class="ti ti-x"></i>
                    关闭
                </button>
            </div>
            <div class="modal-body">
                <div class="file-management-tabs">
                    <button class="file-management-tab active touch-feedback" data-tab="all">全部图片</button>
                    <button class="file-management-tab touch-feedback" data-tab="favorites">收藏图片</button>
                    <button class="file-management-tab touch-feedback" data-tab="recent">最近上传</button>
                    <button class="file-management-tab touch-feedback" data-tab="large">大尺寸图片</button>
                </div>
            
                <!-- 批量操作区域 -->
                <div class="file-management-batch-actions" id="batchImageActions">
                    <span id="selectedImageCount">已选择 0 张图片</span>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-danger touch-feedback" id="batchImageDelete">
                            <i class="ti ti-trash"></i>
                            批量删除
                        </button>
                        <button class="btn btn-primary touch-feedback" id="batchImageDownload">
                            <i class="ti ti-download"></i>
                            批量下载
                        </button>
                        <button class="btn btn-success touch-feedback" id="batchImageFavorite">
                            <i class="ti ti-star"></i>
                            批量收藏
                        </button>
                    </div>
                </div>

                <!-- 单图片操作区域 -->
                <div class="file-management-single-actions" id="singleImageActions">
                    <span id="singleImageCount">已选择 1 张图片</span>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-danger touch-feedback" id="singleImageDelete">
                            <i class="ti ti-trash"></i>
                            删除
                        </button>
                        <button class="btn btn-primary touch-feedback" id="singleImageDownload">
                            <i class="ti ti-download"></i>
                            下载
                        </button>
                        <button class="btn btn-success touch-feedback" id="singleImageFavorite">
                            <i class="ti ti-star"></i>
                            收藏
                        </button>
                        <button class="btn btn-secondary touch-feedback" id="singleImageView">
                            <i class="ti ti-eye"></i>
                            查看
                        </button>
                    </div>
                </div>
            
                <div class="file-management-content">
                    <div class="image-management-list" id="imageManagementList">
                        <!-- 图片列表将由JavaScript动态生成 -->
                    </div>
                </div>
            
                <div class="file-management-actions">
                    <button class="btn btn-secondary touch-feedback" id="selectAllImages">
                        <i class="ti ti-square"></i>
                        全选
                    </button>
                    <button class="btn btn-secondary touch-feedback" id="cancelImageSelection">
                        <i class="ti ti-x"></i>
                        取消选择
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 重复文件处理弹窗 -->
    <div class="modal-overlay" id="duplicateFileModal" style="display: none;">
        <div class="modal-content duplicate-file-modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">发现重复文件</h3>
            </div>
            <div class="modal-body">
                <div class="duplicate-file-container" id="duplicateFileContainer">
                    <!-- 内容由JavaScript动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <div class="duplicate-file-stats">
                    <span id="duplicateFileStats">正在处理第 1 个重复文件，共 1 个</span>
                </div>
                <div class="duplicate-file-actions">
                    <button class="btn btn-secondary touch-feedback" id="skipDuplicate">
                        <i class="ti ti-x"></i>
                        跳过此文件
                    </button>
                    <button class="btn btn-success touch-feedback" id="addAsNew">
                        <i class="ti ti-file-plus"></i>
                        添加为新文件
                    </button>
                    <button class="btn btn-danger touch-feedback" id="replaceFile">
                        <i class="ti ti-refresh"></i>
                        替换现有文件
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 截图预览弹窗 -->
    <div class="modal-overlay" id="screenshotPreviewModal" style="display: none;">
        <div class="modal-content screenshot-preview-modal">
            <div class="modal-header">
                <h3 class="modal-title">截图预览</h3>
                <button class="btn btn-secondary touch-feedback" id="closePreviewModal">
                    <i class="ti ti-x"></i>
                    关闭
                </button>
            </div>
            <div class="modal-body screenshot-preview-container">
                <!-- 内容由JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 下载进度弹窗 -->
    <div class="modal-overlay" id="downloadProgressModal" style="display: none;">
        <div class="modal-content download-progress-modal">
            <div class="modal-header">
                <h3 class="modal-title">正在生成截图</h3>
            </div>
            <div class="modal-body download-progress-container">
                <!-- 内容由JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 图片上传进度弹窗 -->
    <div class="modal-overlay" id="imageUploadModal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">图片上传进度</h3>
            </div>
            <div class="modal-body">
                <div class="upload-progress">
                    <div class="progress-text" id="imageUploadText">正在上传第 1 张图片，共 10 张</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="imageUploadProgress"></div>
                    </div>
                    <div class="upload-stats">
                        <span id="uploadedCount">0</span> / <span id="totalCount">0</span>
                    </div>
                </div>
                <div class="upload-details" id="currentImageName">
                    当前：example.jpg
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 文件 -->
    <script src="js/utils.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/announcement.js"></script>
    <script src="js/file-manager.js"></script>
    <script src="js/image-manager.js"></script>
    <script src="js/console.js"></script>
    <script src="js/scroll-manager.js"></script>
    <script src="js/file-management-modal.js"></script>
    <script src="js/screenshot.js"></script>
    <script src="js/screenshot-preview.js"></script>
    <script src="js/screenshot-animation.js"></script>
    <script src="js/screenshot-manager.js"></script>
    <script src="js/drag-drop.js"></script>
    
    <!-- 修复脚本 -->
    <script>
    // 修复脚本：确保图片管理功能正常工作
    document.addEventListener('DOMContentLoaded', function() {
        // 修复图片管理按钮点击事件
        document.addEventListener('click', function(e) {
            if (e.target.closest('#imageManagementBtn')) {
                e.preventDefault();
                e.stopPropagation();
                const modal = document.getElementById('imageManagementModal');
                if (modal) {
                    modal.classList.add('active');
                    // 如果图片管理器存在，渲染图片列表
                    if (window.imageManager && window.imageManager.renderImageManagementList) {
                        setTimeout(() => {
                            window.imageManager.renderImageManagementList();
                        }, 100);
                    }
                }
            }
            
            if (e.target.closest('#exportImagesBtn')) {
                e.preventDefault();
                e.stopPropagation();
                if (window.imageManager && window.imageManager.exportImageData) {
                    window.imageManager.exportImageData();
                } else {
                    alert('图片管理器未初始化');
                }
            }
            
            if (e.target.closest('#clearImagesBtn')) {
                e.preventDefault();
                e.stopPropagation();
                if (window.imageManager && window.imageManager.clearAllImages) {
                    // 这里不显示确认框，由 image-manager.js 中的方法处理确认
                    window.imageManager.clearAllImages();
                } else {
                    alert('图片管理器未初始化');
                }
            }
            
            // 修复查看按钮点击 - 使用事件委托
            if (e.target.closest('.btn-view-image')) {
                e.preventDefault();
                e.stopPropagation();
                const button = e.target.closest('.btn-view-image');
                const imageId = button.dataset.id;
                
                if (imageId && window.imageManager) {
                    const image = window.imageManager.allImages.find(img => img.id == imageId);
                    if (image) {
                        console.log('查看图片（修复脚本）:', image.name);
                        window.imageManager.showImageModal(image);
                    }
                }
            }
            
            // 修复图片预览点击 - 使用事件委托
            if (e.target.closest('.image-preview')) {
                e.preventDefault();
                e.stopPropagation();
                const img = e.target.closest('.image-preview');
                const imageId = img.dataset.id;
                
                if (imageId && window.imageManager) {
                    const image = window.imageManager.allImages.find(img => img.id == imageId);
                    if (image) {
                        console.log('查看图片（预览点击修复）:', image.name);
                        window.imageManager.showImageModal(image);
                    }
                }
            }
            
            // 修复图片管理弹窗中的查看按钮
            if (e.target.closest('#singleImageView')) {
                e.preventDefault();
                e.stopPropagation();
                const selectedImages = document.querySelectorAll('.image-management-item.selected');
                if (selectedImages.length === 1) {
                    const imageId = selectedImages[0].dataset.id;
                    if (imageId && window.imageManager) {
                        const image = window.imageManager.allImages.find(img => img.id == imageId);
                        if (image) {
                            window.imageManager.showImageModal(image);
                        }
                    }
                }
            }
        });
        
        // 修复图片管理弹窗关闭按钮
        const closeImageManagementBtn = document.getElementById('closeImageManagementModal');
        if (closeImageManagementBtn) {
            closeImageManagementBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const modal = document.getElementById('imageManagementModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        }
        
        // 修复图片预览弹窗关闭按钮
        const closeImageBtn = document.getElementById('closeImageModal');
        if (closeImageBtn) {
            closeImageBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const modal = document.getElementById('imagePreviewModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        }
        
        // 修复模态框外部点击关闭
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
        
        // 监听页面切换，确保图片卡片事件正确绑定
        window.addEventListener('pageChanged', function(e) {
            if (e.detail.page === 'images') {
                // 稍后重新绑定图片卡片事件
                setTimeout(() => {
                    bindImageCardEvents();
                }, 500);
            }
        });
        
        // 辅助函数：绑定图片卡片事件
        function bindImageCardEvents() {
            console.log('绑定图片卡片事件');
            
            // 使用事件委托方式，不需要重新绑定
            // 所有点击事件已经在页面级别的监听器中处理
        }
        
        // 暴露函数到全局，便于调试
        window.bindImageCardEvents = bindImageCardEvents;
        
        // 在应用启动后初始化事件监听
        setTimeout(() => {
            console.log('初始化图片相关事件监听');
        }, 2000);
    });
    
    // 全局事件委托 - 确保图片查看功能正常工作
    document.addEventListener('click', function(e) {
        // 修复图片查看按钮点击
        if (e.target.closest('.btn-view-image')) {
            e.preventDefault();
            e.stopPropagation();
            const button = e.target.closest('.btn-view-image');
            const imageId = button.dataset.id;
            
            if (imageId && window.imageManager) {
                const image = window.imageManager.allImages.find(img => img.id == imageId);
                if (image) {
                    console.log('全局事件委托：查看图片', image.name);
                    window.imageManager.showImageModal(image);
                }
            }
        }
        
        // 修复图片预览点击
        if (e.target.closest('.image-preview')) {
            e.preventDefault();
            e.stopPropagation();
            const img = e.target.closest('.image-preview');
            const imageId = img.dataset.id;
            
            if (imageId && window.imageManager) {
                const image = window.imageManager.allImages.find(img => img.id == imageId);
                if (image) {
                    console.log('全局事件委托：查看图片（预览）', image.name);
                    window.imageManager.showImageModal(image);
                }
            }
        }
    });
    </script>
    
    <script src="js/main.js"></script>
</body>
</html>